//
// Generated by JSON2Apex http://json2apex.herokuapp.com/
//
// The supplied json has fields with names that are reserved words in apex
// and so can only be parsed with explicitly generated code, this option
// was auto selected for you.

public class CodeTestRunSummary {

    public Integer size {get;set;}
    public Integer totalSize {get;set;}
    public Boolean done {get;set;}
    public String queryLocator {get;set;}
    public String entityTypeName {get;set;}
    public List<Records> records {get;set;}
    public Exception error {get;set;}

    public class Attributes {
        public String type_Z {get;set;} // in json: type
        public String url {get;set;}
    }

    public class Records {
        public Attributes attributes {get;set;}
        public String startTime {get;set;}
        public String endTime {get;set;}
        public Integer methodsFailed {get;set;}
        public Integer methodsCompleted {get;set;}
        public String asyncApexJobId {get;set;}
    }

    public Map<String, Unit_Test_Summary__c> deconstructIntoSobjectRecords() {
        Map<String, Unit_Test_Summary__c> recordsToReturn = new Map<String, Unit_Test_Summary__c>();

        if (records != null) {
            for (Records rec : records) {
                Unit_Test_Summary__c unitTestSummary = null;

                if (error == null) {
                    DateTime startTime = rec.startTime != null ? DateTime.valueOf(rec.startTime.replace('T', ' ')) : null;
                    DateTime endTime = rec.endTime != null ? DateTime.valueOf(rec.endTime.replace('T', ' ')) : null;

                    unitTestSummary = new Unit_Test_Summary__c(
                        Test_Date__c = startTime != null ? startTime.Date() : null,
                        Total_Apex_Unit_Tests__c = rec.methodsCompleted,
                        Apex_Test_Time__c = 
                            (endTime != null && startTime != null) ? 
                            ((endTime.getTime() - startTime.getTime()) / 1000) : 
                            null,
                        Failed_Apex_Tests__c = rec.methodsFailed,
                        System_Error__c = false,
                        Completed__c = true
                    );
                } else {
                    unitTestSummary = new Unit_Test_Summary__c(
                        Error_Details__c = error.getMessage(),
                        System_Error__c = true,
                        Completed__c = true
                    );
                }

                if (unitTestSummary != null) {
                    recordsToReturn.put(rec.asyncApexJobId, unitTestSummary);
                }
            }
        }

        return recordsToReturn;
    }
}